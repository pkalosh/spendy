{% extends "partials/user-base.html" %}
{% load static %}
{% load humanize %}
{% block content %}
<!-- Dashboard Section start -->
<section class="dashboard-section body-collapse">
    <div class="overlay pt-120">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">

                    <!-- Wallets Section -->
                    <div id="wallets" class="content-section mb-5">
                        <h4 class="text-2xl font-bold mb-4">Active Wallets</h4>
                        <div class="row">
                            {% for wallet in wallets %}
                            <div class="col-md-4 mb-4">
                                <div class="bg-white p-4 shadow rounded-md h-100">
                                    <h5 class="text-lg font-semibold mb-2">{{ wallet.name }}</h5>
                                    <p class="text-xl font-bold {% if wallet.color == 'green' %}text-green-600{% elif wallet.color == 'yellow' %}text-yellow-600{% elif wallet.color == 'red' %}text-red-600{% endif %}">
                                        ${{ wallet.balance|intcomma }}
                                    </p>
                                </div>
                            </div>
                            {% empty %}
                            <div class="col-12">
                                <p class="text-center text-gray-500">No active wallets found.</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Transactions and Requests Section -->
                    <div class="transactions-area mb-5">
                        <div class="d-flex align-items-center justify-content-between mb-4">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="requests-tab" data-bs-toggle="tab" data-bs-target="#requests" type="button" role="tab" aria-controls="requests" aria-selected="true">
                                        Requests
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="transactions-tab" data-bs-toggle="tab" data-bs-target="#transactions" type="button" role="tab" aria-controls="transactions" aria-selected="false">
                                        Transactions
                                    </button>
                                </li>
                            </ul>
                            <div>
                                <button class="btn btn-primary me-3" data-bs-toggle="modal" data-bs-target="#submitRequestModal">
                                    Submit Request
                                </button>
                                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#makePaymentModal">
                                    Make Payment
                                </button>
                            </div>
                        </div>

                        <div class="tab-content">
                            <!-- Requests Tab -->
                            <div class="tab-pane fade show active" id="requests" role="tabpanel" aria-labelledby="requests-tab">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead class="bg-light">
                                            <tr>
                                                <th>Request Type</th>
                                                <th>Amount</th>
                                                <th>Description</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for request in requests %}
                                            <tr>
                                                <td>{{ request.type }}</td>
                                                <td>${{ request.amount|intcomma }}</td>
                                                <td>{{ request.description }}</td>
                                                <td class="{% if request.status == 'Pending' %}text-warning{% elif request.status == 'Completed' %}text-success{% else %}text-danger{% endif %}">
                                                    {{ request.status }}
                                                </td>
                                                <td>
                                                    <a href="" class="btn btn-sm btn-info">View</a>
                                                    {% if request.status == 'Pending' %}
                                                    <a href="" class="btn btn-sm btn-warning">Edit</a>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center text-gray-500">No requests found.</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Transactions Tab -->
                            <div class="tab-pane fade" id="transactions" role="tabpanel" aria-labelledby="transactions-tab">
                                <h5 class="text-xl font-bold mt-4">Transaction History</h5>
                                <div class="table-responsive mt-3">
                                    <table class="table table-bordered table-hover">
                                        <thead class="bg-light">
                                            <tr>
                                                <th>Transaction ID</th>
                                                <th>Amount</th>
                                                <th>Date</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for transaction in transactions %}
                                            <tr>
                                                <td>{{ transaction.txn_id }}</td>
                                                <td>${{ transaction.amount|intcomma }}</td>
                                                <td>{{ transaction.date|date:"M d, Y" }}</td>
                                                <td class="{% if transaction.status == 'Completed' %}text-success{% elif transaction.status == 'Pending' %}text-warning{% else %}text-danger{% endif %}">
                                                    {{ transaction.status }}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="4" class="text-center text-gray-500">No transactions found.</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>

                </div> <!-- End col-12 -->
            </div> <!-- End row -->
        </div> <!-- End container-fluid -->
    </div> <!-- End overlay -->
</section>
    <!-- Submit Request Modal -->
 <!-- Submit Request Modal -->
<div class="modal fade" id="submitRequestModal" tabindex="-1" aria-labelledby="submitRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="submitRequestModalLabel" class="modal-title">Submit Request</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="bg-white p-3">
                    <!-- Request Type -->
                    <label class="form-label">Request Type</label>
                    <select id="requestType" class="form-select" onchange="toggleRequestFields()">
                        <option value="">Select Type</option>
                        <option value="event">Event</option>
                        <option value="operation">Operation</option>
                    </select>

                    <!-- Event-specific Fields -->
                    <div id="eventRequestFields" class="mt-3 d-none">
                        <label class="form-label">Event Name</label>
                        <select class="form-select">
                            <option value="">Select an Event</option>
                            <option value="conference">Conference</option>
                            <option value="workshop">Workshop</option>
                            <option value="meeting">Meeting</option>
                        </select>

                        <label class="form-label mt-3">Expense Category</label>
                        <select class="form-select">
                            <option value="">Select a Category</option>
                            <option value="marketing">Marketing</option>
                            <option value="logistics">Logistics</option>
                            <option value="travel">Travel</option>
                        </select>
                    </div>

                    <!-- Operation-specific Fields -->
                    <div id="operationRequestFields" class="mt-3 d-none">
                        <label class="form-label">Operation Category</label>
                        <select class="form-select">
                            <option value="">Select an Operation</option>
                            <option value="office_maintenance">Office Maintenance</option>
                            <option value="supplies">Supplies</option>
                            <option value="staff_welfare">Staff Welfare</option>
                        </select>
                    </div>

                    <!-- Common Fields -->
                    <div class="mt-3">
                        <label class="form-label">Amount</label>
                        <input type="number" class="form-control" placeholder="Enter amount">

                        <label class="form-label mt-3">Description</label>
                        <textarea class="form-control" rows="3" placeholder="Enter reason for request"></textarea>
                    </div>

                    <button class="btn btn-primary w-100 mt-4" type="submit">Submit Request</button>
                </form>
            </div>
        </div>
    </div>
</div>

     <!-- Make Payment Modal -->
<!-- Make Payment Modal -->
<div class="modal fade" id="makePaymentModal" tabindex="-1" aria-labelledby="makePaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="makePaymentModalLabel" class="modal-title">Make Payment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form class="bg-white p-3">
                    <!-- Select Request to Pay Against -->
                    <label class="form-label">Select Request</label>
                    <select class="form-select">
                        <option value="">Choose a request</option>
                        <option value="event1">Event - Marketing ($500)</option>
                        <option value="operation1">Operation - Office Maintenance ($1,200)</option>
                    </select>

                    <!-- Payment Method -->
                    <label class="form-label mt-3">Payment Method</label>
                    <select id="paymentMethod" class="form-select" onchange="togglePaymentFields()">
                        <option value="mpesa_number">M-Pesa Number</option>
                        <option value="paybill">Paybill</option>
                        <option value="till_number">Till Number</option>
                    </select>

                    <!-- M-Pesa Number -->
                    <div id="mpesaNumberSection" class="mt-3">
                        <label class="form-label">M-Pesa Number</label>
                        <input type="text" class="form-control" placeholder="Enter M-Pesa number">
                    </div>

                    <!-- Paybill Section -->
                    <div id="paybillSection" class="mt-3 d-none">
                        <label class="form-label">Paybill Number</label>
                        <input type="text" class="form-control" placeholder="Enter Paybill number">

                        <label class="form-label mt-3">Account Number</label>
                        <input type="text" class="form-control" placeholder="Enter account number">
                    </div>

                    <!-- Till Number Section -->
                    <div id="tillNumberSection" class="mt-3 d-none">
                        <label class="form-label">Till Number</label>
                        <input type="text" class="form-control" placeholder="Enter till number">
                    </div>

                    <button class="btn btn-success w-100 mt-4" type="submit">Make Payment</button>
                </form>
            </div>
        </div>
    </div>
</div>


    <!-- Bootstrap 5 + JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script>
        function toggleRequestFields() {
            var type = document.getElementById('requestType').value;
            document.getElementById('eventRequestFields').classList.toggle('d-none', type !== 'event');
            document.getElementById('operationRequestFields').classList.toggle('d-none', type !== 'operation');
        }

        function togglePaymentFields() {
            var method = document.getElementById('paymentMethod').value;
            document.getElementById('mpesaNumberSection').classList.toggle('d-none', method !== 'mpesa_number');
            document.getElementById('paybillSection').classList.toggle('d-none', method !== 'paybill');
            document.getElementById('tillNumberSection').classList.toggle('d-none', method !== 'till_number');
        }
    </script>
{% endblock content %}
