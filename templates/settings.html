{% extends "partials/dashboard-base.html" %}
{% load static %}
{% load humanize %}

{% block content %}
<!-- Dashboard Section start -->
<section class="dashboard-section body-collapse">
    <div class="overlay pt-120">
        <div class="container-fruid">
            <div class="row">
                <div class="col-xl-12 col-lg-12">
                    <div class="section-content">
                        <div class="transactions-area">
                            <div class="section-text d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>System Settings</h5>
                                    <p>Manage event categories, expense categories, groups, and other settings.</p>
                                </div>
                            </div>
                            
                            <div class="settings-container mt-4">
                                <div class="row">
                                    <div class="col-md-4">
                                        <button class="btn btn-primary w-100 mb-3" data-bs-toggle="modal" data-bs-target="#expenseCategoryModal">
                                            Add Expense Category
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary w-100 mb-3" data-bs-toggle="modal" data-bs-target="#operationCategoryModal">
                                            Add Operation Category
                                        </button>
                                    </div>
                                    <div class="col-md-4">
                                        <button class="btn btn-primary w-100 mb-3" data-bs-toggle="modal" data-bs-target="#eventCategoryModal">
                                            Add Event Category
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Category Lists -->
                                <div class="row mt-4">
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>Expense Categories</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="list-group">
                                                    {% for category in expense_categories %}
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        {{ category.name }}
                                                        <div>
                                                            <button class="btn btn-sm btn-outline-primary edit-category" 
                                                                    data-type="expense" 
                                                                    data-id="{{ category.id }}"
                                                                    data-name="{{ category.name }}">
                                                                Edit
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger delete-category"
                                                                    data-type="expense"
                                                                    data-id="{{ category.id }}">
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </li>
                                                    {% empty %}
                                                    <li class="list-group-item text-center">No expense categories found</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>Operation Categories</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="list-group">
                                                    {% for category in operation_categories %}
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        {{ category.name }}
                                                        <div>
                                                            <button class="btn btn-sm btn-outline-primary edit-category" 
                                                                    data-type="operation" 
                                                                    data-id="{{ category.id }}"
                                                                    data-name="{{ category.name }}">
                                                                Edit
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger delete-category"
                                                                    data-type="operation"
                                                                    data-id="{{ category.id }}">
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </li>
                                                    {% empty %}
                                                    <li class="list-group-item text-center">No operation categories found</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6>Event Categories</h6>
                                            </div>
                                            <div class="card-body">
                                                <ul class="list-group">
                                                    {% for category in event_categories %}
                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                        {{ category.name }}
                                                        <div>
                                                            <button class="btn btn-sm btn-outline-primary edit-category" 
                                                                    data-type="event" 
                                                                    data-id="{{ category.id }}"
                                                                    data-name="{{ category.name }}">
                                                                Edit
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger delete-category"
                                                                    data-type="event"
                                                                    data-id="{{ category.id }}">
                                                                Delete
                                                            </button>
                                                        </div>
                                                    </li>
                                                    {% empty %}
                                                    <li class="list-group-item text-center">No event categories found</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Expense Category Modal -->
<div class="modal fade" id="expenseCategoryModal" tabindex="-1" aria-labelledby="expenseCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="expenseCategoryModalLabel">Add Expense Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'wallet:add_expense_category' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="expenseCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" id="expenseCategoryName" name="name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Operation Category Modal -->
<div class="modal fade" id="operationCategoryModal" tabindex="-1" aria-labelledby="operationCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="operationCategoryModalLabel">Add Operation Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'wallet:add_operation_category' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="operationCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" id="operationCategoryName" name="name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Event Category Modal -->
<div class="modal fade" id="eventCategoryModal" tabindex="-1" aria-labelledby="eventCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventCategoryModalLabel">Add Event Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="{% url 'wallet:add_event_category' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="eventCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" id="eventCategoryName" name="name" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Category Modal -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCategoryModalLabel">Edit Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editCategoryForm" method="post">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editCategoryName" class="form-label">Category Name</label>
                        <input type="text" class="form-control" id="editCategoryName" name="name" required>
                        <input type="hidden" id="editCategoryId" name="category_id">
                        <input type="hidden" id="editCategoryType" name="category_type">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this category? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteCategoryForm" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="deleteCategoryId" name="category_id">
                    <input type="hidden" id="deleteCategoryType" name="category_type">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // Edit category button click handler
        $('.edit-category').click(function() {
            const categoryId = $(this).data('id');
            const categoryName = $(this).data('name');
            const categoryType = $(this).data('type');
            
            $('#editCategoryId').val(categoryId);
            $('#editCategoryName').val(categoryName);
            $('#editCategoryType').val(categoryType);
            
            // Set the form action based on the category type
            const formAction = `{% url 'wallet:edit_category' %}?type=${categoryType}`;
            $('#editCategoryForm').attr('action', formAction);
            
            $('#editCategoryModal').modal('show');
        });
        
        // Delete category button click handler
        $('.delete-category').click(function() {
            const categoryId = $(this).data('id');
            const categoryType = $(this).data('type');
            
            $('#deleteCategoryId').val(categoryId);
            $('#deleteCategoryType').val(categoryType);
            
            // Set the form action based on the category type
            const formAction = `{% url 'wallet:delete_category' %}?type=${categoryType}`;
            $('#deleteCategoryForm').attr('action', formAction);
            
            $('#confirmDeleteModal').modal('show');
        });
    });
</script>
{% endblock %}

