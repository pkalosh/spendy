{% extends "partials/dashboard-base.html" %}
{% load static %}
{% load expense_tags %}
{% block content %}
<section class="dashboard-section body-collapse">
<div class="overlay pt-120">
<div class="container-fluid">
<div class="section-header" style="background-color: #98e23f; color: white; padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem;">
<div class="row align-items-center">
<div class="col-lg-8">
<h4 class="section-title text-white mb-0">Suppliers</h4>
<p class="section-subtitle mb-0 opacity-75">Create and manage suppliers.</p>
</div>
<div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
<button class="btn btn-light" data-bs-toggle="modal" data-bs-target="#newSupplierModal">
<i class="fas fa-plus me-2"></i>New Supplier
</button>
</div>
</div>
</div>
<div class="table-responsive mt-4">
<table class="table table-hover">
<thead>
<tr>
<th>#</th>
<th>Name</th>
<th>Category</th>
<th>Captured</th>
<th>Mobile</th>
<th>Email</th>
<th>Actions</th>
</tr>
</thead>
<tbody>
                        {% for sup in suppliers %}
<tr>
<td>{{ forloop.counter }}</td>
<td>{{ sup.name }}</td>
<td>{{ sup.get_service_category_display }}</td>
<td>{{ sup.date_captured|date:"Y-m-d" }}</td>
<td>{{ sup.mobile_number }}</td>
<td>{{ sup.email }}</td>
<td>
<a class="btn btn-sm btn-outline-success" href="{% url 'expense:supplier_invoices' sup.id %}">Invoices</a>
<button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#editSupplierModal-{{ sup.id }}">Edit</button>
<button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteSupplierModal-{{ sup.id }}">Delete</button>
</td>
</tr>
                        {% endfor %}
</tbody>
</table>
</div>
</div>
</div>
</section>
<!-- Edit and Delete Modals (moved outside the table for proper HTML structure) -->
{% for sup in suppliers %}
<!-- EDIT SUPPLIER MODAL -->
<div class="modal fade" id="editSupplierModal-{{ sup.id }}" tabindex="-1" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<form method="post" action="{% url 'expense:supplier-edit' sup.id %}">
                    {% csrf_token %}
<div class="modal-header bg-light">
<h5 class="modal-title">Edit Supplier — {{ sup.name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
                        {% with form=supplier_edit_forms|get_item:sup.id %}
<div class="row g-3">
{% for field in form %}
<div class="col-12 col-md-6">
<label class="form-label fw-bold" for="{{ field.id_for_label }}">{{ field.label }}</label>
{{ field }}
{% if field.errors %}<div class="text-danger small">{{ field.errors }}</div>{% endif %}
{% if field.help_text %}<small class="text-muted">{{ field.help_text }}</small>{% endif %}
</div>
{% endfor %}
</div>
                        {% endwith %}
</div>
<div class="modal-footer">
<button type="submit" class="btn btn-primary">Save</button>
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
</div>
</form>
</div>
</div>
</div>
<!-- DELETE SUPPLIER MODAL -->
<div class="modal fade" id="deleteSupplierModal-{{ sup.id }}" tabindex="-1" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<form method="post" action="{% url 'expense:supplier-delete' sup.id %}">
                    {% csrf_token %}
<div class="modal-header bg-light">
<h5 class="modal-title">Delete Supplier — {{ sup.name }}</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div class="row g-3">
<div class="col-12">
<p class="mb-0">Are you sure you want to remove this supplier? This action cannot be undone.</p>
</div>
</div>
</div>
<div class="modal-footer">
<button type="submit" class="btn btn-danger">Yes, remove</button>
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
</div>
</form>
</div>
</div>
</div>
{% endfor %}
<!-- NEW SUPPLIER MODAL -->
<div class="modal fade" id="newSupplierModal" tabindex="-1" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<form method="post" action="{% url 'expense:supplier-create' %}">
                {% csrf_token %}
<div class="modal-header bg-light">
<h5 class="modal-title">New Supplier</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div class="row g-3">
{% for field in new_form %}
<div class="col-12 col-md-6">
<label class="form-label fw-bold" for="{{ field.id_for_label }}">{{ field.label }}</label>
{{ field }}
{% if field.errors %}<div class="text-danger small">{{ field.errors }}</div>{% endif %}
{% if field.help_text %}<small class="text-muted">{{ field.help_text }}</small>{% endif %}
</div>
{% endfor %}
</div>
</div>
<div class="modal-footer">
<button type="submit" class="btn btn-primary">Create Supplier</button>
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
</div>
</form>
</div>
</div>
</div>
<style>
.section-header {
background: linear-gradient(135deg, #98e23f 0%, #7bb732 100%);
}
.btn-light:hover {
background-color: #fff;
border-color: #fff;
color: #000;
}
.modal-body input, .modal-body select, .modal-body textarea {
    border-radius: 0.375rem;
    border: 1px solid #ced4da;
    padding: 0.375rem 0.75rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}
.modal-body input:focus, .modal-body select:focus, .modal-body textarea:focus {
    border-color: #98e23f;
    box-shadow: 0 0 0 0.2rem rgba(152, 226, 63, 0.25);
    outline: 0;
}
</style>
{% endblock content %}