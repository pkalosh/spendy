{% extends "partials/dashboard-base.html" %}
{% load static %}
{% load humanize %}
{% block content %}

    <!-- Dashboard Section start -->
    <section class="dashboard-section body-collapse">
        
        <div class="overlay pt-120">
            <div class="container-fruid">
                {% if form.errors %}
                    <div class="alert alert-danger">
                        <strong>{{form.errors}}</strong>
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col-xl-8 col-lg-7">
                        <div class="section-content">
                            <div class="acc-details">
                                <div class="top-area">
                                    <div class="left-side">
                                        <h5>Hi, {{request.user.first_name|title}} {{request.user.last_name|title}}!</h5>
                                        <h2>{{wallet.currency}}:{{wallet.balance|intcomma}}</h2>
                                        
                                       
                                            
                                    </div>
                                    <div class="right-side">
                                        <div class="right-top">
                                            <select>
                                                <option value="1"> {{wallet.currency}}</option>
                                            </select>
                                        </div>
                                      
                                        
                                    </div>
                                </div>
                                <div class="bottom-area">
                                    <div class="left-side">
                                        <a href="" class="cmn-btn"  id="transactionssent" data-bs-toggle="modal" data-bs-target="#transactionsModsent" aria-controls="transactionsModsent" aria-selected="true" >Send Money</a>
                                        <a href="" class="cmn-btn" id="transactionswithdrawal" data-bs-toggle="modal" data-bs-target="#transactionsModwithdrawal" aria-controls="transactionsModwithdrawal" aria-selected="true">Withdraw Money</a>
                                        <a href="" class="cmn-btn" id="transactionsdeposit" data-bs-toggle="modal" data-bs-target="#transactionsModdeposit" aria-controls="transactionsModdeposit" aria-selected="true">Deposit Money</a>
                                    </div>
                                    
                                </div>
                            </div>
                            <div class="transactions-area">
                                <div class="section-text">
                                    <h5>Transactions</h5>
                                    <p>Updated every several minutes</p>
                                </div>
                               
                                <div class="tab-content mt-40">
                                    <div class="">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">Sender</th>
                                                        <th scope="col">Recipient</th>
                                                        <th scope="col">Country</th>
                                                        <th scope="col">Amount</th>
                                                        <th scope="col">Status</th>
                                                        <th scope="col">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                    {% for s in deposits %}
                                                
                                                        <tr class="mdr">
                                                            <th scope="row">
                                                                <p class="mdr">{{s.wallet.user.first_name|title}} {{s.wallet.user.last_name|title}} - {{s.wallet.wallet_number}}</p>
                                                            </th>
                                                            <th scope="row">
                                                                <p class="mdr">{{s.recipient.user.first_name|title}} {{s.recipient.user.last_name|title}} - {{s.recipient.wallet_number}}</p>
                                                            </th>
                                                        <td>
                                                            <p class="mdr">{{s.wallet.user.country|title}}</p>
                                                        </td>
                
                                                        
                                                        <td>
                                                            <p> - {{s.wallet.currency}} {{s.amount|intcomma}}</p>
                                                        </td>
                                                            <td>
                                                                {% if s.status == 'COMPLETED' %}
                                                                    <p class="text-success">{{s.status|title}}</p>
                                                                {% endif %}
                                                                {% if s.status == 'PENDING' %}
                                                                    <p class="inprogress">{{s.status|title}}</p>
                                                                {% endif %}
                                                                {% if s.status == 'FAILED' %}
                                                                    <p class="danger">{{s.status|title}}</p>
                                                                {% endif %}
                                                                {% if s.status == 'CANCELLED' %}
                                                                    <p class="danger">{{s.status|title}}</p>
                                                                {% endif %}
                                                            </td>
                                                            
                                                            <td>
                                                                <a href="{% url 'wallet:transaction-detail' s.id %}" class=""><i class="fas fa-eye"></i></a>

                                                            </td>
                                                        </tr>

                                                            <!-- Transactions Popup start -->
                                                        <div class="transactions-popup">
                                                            <div class="container-fruid">
                                                                <div class="row">
                                                                    <div class="col-lg-6">
                                                                        <div class="modal fade" id="transactionsdetails-{{ s.id }}" aria-hidden="true">
                                                                            <div class="modal-dialog modal-dialog-centered">
                                                                                <div class="modal-content">
                                                                                    <div class="modal-header justify-content-between">
                                                                                        <h5>Transaction Details</h5>
                                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                                    </div>
                                                                                    <div class="main-content">
                                                                                        <div class="row">
                                                                                            <div class="col-sm-5 text-center">
                                                                                                <div class="icon-area">
                                                                                                    <img src="{% static 'assets1/images/icon/transaction-details-icon.png' %}" alt="icon">
                                                                                                </div>
                                                                                                <div class="text-area">
                                                                                                    <h6>CashEx </h6>
                                                                                                    <p>{{s.date}}</p>
                                                                                                    <h3>{{s.amount}}{{s.wallet.currency}}</h3>
                                                                                                    <p class="com">{{s.status}}</p>
                                                                                                </div>
                                                                                            </div>
                                                                                            <div class="col-sm-7">
                                                                                                <div class="right-area">
                                                                                                    <h6>Transaction Details</h6>
                                                                                                    <ul class="payment-details">
                                                                                                        <li>
                                                                                                            <span>Payment Amount</span>
                                                                                                            <span>{{s.amount}}{{s.wallet.currency}}</span>
                                                                                                        </li>
                                                                                                        <li>
                                                                                                            <span>Fee</span>
                                                                                                            <span>0.00 {{s.wallet.currency}}</span>
                                                                                                        </li>
                                                                                                        <li>
                                                                                                            <span>Total Amount</span>
                                                                                                            <span>{{s.amount}}{{s.wallet.currency}}</span>
                                                                                                        </li>
                                                                                                    </ul>
                                                                                                    <ul class="payment-info">
                                                                                                        <li>
                                                                                                            <p>Payment From</p>
                                                                                                            <span class="mdr">{{s.wallet.user.first_name}}{{s.wallet.user.last_name}}</span>
                                                                                                        </li>
                                                                                                        <li>
                                                                                                            <p>Payment Description</p>
                                                                                                            <span class="mdr">{{s.description}}</span>
                                                                                                        </li>
                                                                                                        <!-- <li>
                                                                                                            <p>Transaction ID:</p>
                                                                                                            <span class="mdr">{{s.reference_id}}</span>
                                                                                                        </li> -->
                                                                                                    </ul>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        {% endfor %}
                                               
                                                    
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                   
                                    
                                  
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="col-xl-4 col-lg-5">
                        <div class="side-items">
                           
                            <div class="single-item">
                                <div class="section-text d-flex align-items-center justify-content-between">
                                    <h6>Payment Analytics</h6>
                                    <div class="select-box">
                                        <select>
                                            <option>Monthly</option>
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="chart"></div>
                            </div>
                            <div class="single-item">
                                <div class="section-text d-flex align-items-center justify-content-between">
                                    <h6>Notification ({{notifications.count}})</h6>
                                    <div class="view-all d-flex align-items-center">
                                        <a href="javascript:void(0)">View All</a>
                                        <img src="{% static 'assets1/images/icon/right-arrow.png' %}" alt="icon">
                                    </div>
                                </div>
                                <ul class="recipients-item">
                                    {% for n in notifications %}
                                        <li>
                                            
                                            <a href="javascript:void(0)" class="d-flex">
                                                <div class="text-area">
                                                    
                                                    {% if n.notification_type == "Credit Alert" %}
                                                    <p class="mdr">You received a payment of <b>${{n.amount}}</b></p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Debit Alert" %}
                                                    <p class="mdr">You sent a payment of <b>${{n.amount}}</b></p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Sent Payment Request" %}
                                                    <p class="mdr">You sent a <b>payment request</b> of <b>${{n.amount}}</b></p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Recieved Payment Request" %}
                                                    <p class="mdr">You received a <b>payment request</b> of <b>${{n.amount}}</b></p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Funded Credit Card" %}
                                                    <p class="mdr">You funded your credit card with <b>${{n.amount}}</b></p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Withdrew Credit Card Funds" %}
                                                    <p class="mdr">You withdrew <b>${{n.amount}}</b> from your credit card</p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Deleted Credit Card" %}
                                                    <p class="mdr">You deleted your credit card</p>
                                                    {% endif %}
                                                    {% if n.notification_type == "Added Credit Card" %}
                                                    <p class="mdr">You added a new  credit card</p>
                                                    {% endif %}
                                                        
                                                    <p class="mdr time-area">{{n.date}}</p>
                                                </div>
                                            </a>
                                            <i class="fa-solid fa-caret-right"></i>
                                        </li>
                                        {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>




                   
                </div>
            </div>
        </div>
    </section>
    <!-- Dashboard Section end -->


    <!-- deposit Popup start -->
    <div class="transactions-popup">
        <div class="container-fruid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="modal fade" id="transactionsModdeposit" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header justify-content-between">
                                    <h5>Transaction Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>

                                </div>
                                <div class="main-content">
                                    <div class="row">
                                        <form action="{% url 'wallet:mpesa-deposit' %}" method="POST">
                                            {% csrf_token %}
                                        <div class="col-sm-12">
                                            <div class="right-area payment-details">
                                                    {{deposit_form}}
                                                    <br>
                                            <button type="submit" class="btn btn-primary">Submit</button>

                                               
                                            </div>
                                        </div>

                                        
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    
    <!-- Sent money Popup start -->
    <div class="transactions-popup">
        <div class="container-fruid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="modal fade" id="transactionsModsent" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header justify-content-between">
                                    <h5>Transaction Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>

                                </div>
                                <div class="main-content">
                                    
                                    <div class="row">
                                        <form action="{% url 'wallet:initiate-send-money' %}" method="POST">
                                            {% csrf_token %}
                                        <div class="col-sm-12">
                                            <div class="right-area payment-details">
                                                    {{sent_form}}
                                                    <br>
                                            <button type="submit" class="btn btn-primary">Submit</button>

                                               
                                            </div>
                                        </div>

                                        
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sent money Popup start -->
    <div class="transactions-popup">
        <div class="container-fruid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="modal fade" id="transactionsModwithdrawal" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header justify-content-between">
                                    <h5>Transaction Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>

                                </div>
                                <div class="main-content">
                                    <div class="row">
                                        <form action="{% url 'wallet:mpesa-deposit' %}" method="POST">
                                            {% csrf_token %}
                                        <div class="col-sm-12">
                                            <div class="right-area payment-details">
                                                    {{deposit_form}}
                                                    <br>
                                            <button type="submit" class="btn btn-primary">Submit</button>

                                               
                                            </div>
                                        </div>

                                        
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transactions Popup start -->
    {% endblock content %}
